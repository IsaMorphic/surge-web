this.data={imageData:{}},onmessage=t=>{function a(t,e){return 0==e?t:a(e,t%e)}const e=t.data.workerId,i=t.data.layers,h=t.data.layerBuffer,d=t.data.maxLayerIdx,r=this.data.imageData[e]??t.data.imageData,o=r.width/a(r.width,r.height),g=r.height/a(r.width,r.height);!function t(a,e,s,f,l,n){const m=e<0?o:i[i.length-(e+1)],w=e<0?g:i[i.length-(e+1)];for(let i=0;i<m;i++)for(let o=0;o<w;o++){let g=h[a++];if(e<d&&(g>0||-2147483648==g)){t(a+(-2147483648==g?0:g>>2),e+1,s+l*i/m,f+n*o/w,l/m,n/w),a++}else if(e==d){g>0||-2147483648==g?g=h[a++]:g<0&&-2147483648!=g&&(g=-g);const t=(2130706432&g)<<1|16777215&g;for(let a=f+n*o/w;a<f+n*(o+1)/w;a++)for(let e=s+l*i/m;e<s+l*(i+1)/m;e++)for(let i=0;i<4;i++)r.data[4*(a*r.width+e)+i]+=2*((t>>8*i&255)<<24>>24)}}}(0,-1,0,0,r.width,r.height),postMessage({workerId:e,imageData:r}),this.data.imageData[e]??=r};