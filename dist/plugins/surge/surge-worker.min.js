this.data={layerIndices:{},imageData:{}},onmessage=a=>{function t(a,e){return 0==e?a:t(e,a%e)}const e=a.data.workerId,i=a.data.layers,d=a.data.layerBuffer,r=a.data.maxLayerIdx,h=this.data.imageData[e]??a.data.imageData,s=h.width/t(h.width,h.height),l=h.height/t(h.width,h.height);let o=this.data.layerIndices[e]??-1;function n(a,t,e,r,g,f){const c=t<0?s:i[i.length-(t+1)],m=t<0?l:i[i.length-(t+1)];for(let i=0;i<c;i++)for(let s=0;s<m;s++){let l=d[a++];if(t<o&&(l>0||-2147483648==l)){n(a+(-2147483648==l?0:l>>2),t+1,e+g*i/c,r+f*s/m,g/c,f/m),a++}else if(t==o){l>0||-2147483648==l?l=d[a++]:l<0&&-2147483648!=l&&(l=-l);const t=(2130706432&l)<<1|16777215&l;for(let a=r+f*s/m;a<r+f*(s+1)/m;a++)for(let d=e+g*i/c;d<e+g*(i+1)/c;d++)for(let e=0;e<4;e++)h.data[4*(a*h.width+d)+e]+=2*((t>>8*e&255)<<24>>24)}}}for(;o<=r;o++)n(0,-1,0,0,h.width,h.height),postMessage({workerId:e,currLayerIdx:o,imageData:h});this.data.layerIndices[e]=o,this.data.imageData[e]??=h};