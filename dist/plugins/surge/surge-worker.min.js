this.data={layerIndices:{},imageData:{}},onmessage=async a=>{function t(a,e){return 0==e?a:t(e,a%e)}const e=a.data.workerId,i=a.data.layers,r=new Int32Array(a.data.layerBuffer),d=a.data.maxLayerIdx,h=this.data.imageData[e]??a.data.imageData,s=h.width/t(h.width,h.height),n=h.height/t(h.width,h.height);let o=this.data.layerIndices[e]??-1;function l(a,t,e,d,g,c){const f=t<0?s:i[i.length-(t+1)],m=t<0?n:i[i.length-(t+1)];for(let i=0;i<f;i++)for(let s=0;s<m;s++){let n=r[a++];if(t<o&&(n>0||-2147483648==n)){l(a+(-2147483648==n?0:n>>2),t+1,e+g*i/f,d+c*s/m,g/f,c/m),a++}else if(t==o){n>0||-2147483648==n?n=r[a++]:n<0&&-2147483648!=n&&(n=-n);const t=(2130706432&n)<<1|16777215&n;for(let a=d+c*s/m;a<d+c*(s+1)/m;a++)for(let r=e+g*i/f;r<e+g*(i+1)/f;r++)for(let e=0;e<4;e++)h.data[4*(a*h.width+r)+e]+=2*((t>>8*e&255)<<24>>24)}}}for(;o<=d;o++){l(0,-1,0,0,h.width,h.height);const a=await createImageBitmap(h);postMessage({workerId:e,currLayerIdx:o,imageBitmap:a})}this.data.layerIndices[e]=o,this.data.imageData[e]??=h};